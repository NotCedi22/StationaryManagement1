@model StationaryManagement1.Models.StationeryRequest

@{
    ViewData["Title"] = "Stationery Request Details";

    var currentUserId = (int?)ViewData["CurrentUserId"];
    var currentUserRole = (string?)ViewData["CurrentUserRole"];
}

<h1>Details</h1>

<div>
    <h4>Request</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Employee</dt>
        <dd class="col-sm-10">@Model.Employee?.Name</dd>

        <dt class="col-sm-2">Superior</dt>
        <dd class="col-sm-10">@Model.Superior?.Name</dd>

        <dt class="col-sm-2">Request Date</dt>
        <dd class="col-sm-10">@Model.RequestDate.ToString("yyyy-MM-dd")</dd>

        <dt class="col-sm-2">From</dt>
        <dd class="col-sm-10">@Model.FromDate?.ToString("yyyy-MM-dd")</dd>

        <dt class="col-sm-2">To</dt>
        <dd class="col-sm-10">@Model.ToDate?.ToString("yyyy-MM-dd")</dd>

        <dt class="col-sm-2">Reason</dt>
        <dd class="col-sm-10">@Model.Reason</dd>

        <dt class="col-sm-2">Total Cost</dt>
        <dd class="col-sm-10">@Model.TotalCost</dd>

        <dt class="col-sm-2">Status</dt>
        <dd class="col-sm-10">@Model.Status</dd>
    </dl>
</div>


<div class="mt-3">
    @* Only show Edit button if user is Admin or Manager *@
    @if (currentUserRole == "Admin" || currentUserRole == "Manager")
    {
        <a asp-action="Edit" asp-route-id="@Model.RequestId" class="btn btn-warning">Edit</a>
    }

    @* Employee: withdraw pending *@
    @if (currentUserRole == "Employee" && Model.EmployeeId == currentUserId && Model.Status == "Pending")
    {
        <form asp-action="Withdraw" asp-route-id="@Model.RequestId" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-danger">Withdraw</button>
        </form>
    }

    @* Employee: request cancel approved *@
    @if (currentUserRole == "Employee" && Model.EmployeeId == currentUserId && Model.Status == "Approved")
    {
        <form asp-action="RequestCancel" asp-route-id="@Model.RequestId" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-danger">Request Cancel</button>
        </form>
    }

    @* Employee: withdraw cancellation while pending *@
    @if (currentUserRole == "Employee" && Model.EmployeeId == currentUserId && Model.Status == "CancelPending")
    {
        <form asp-action="RevertCancel" asp-route-id="@Model.RequestId" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-secondary">Withdraw Cancel</button>
        </form>
    }

    @* Superior/Manager/Admin: approve cancel when pending *@
    @if (Model.Status == "CancelPending" &&
        ((currentUserRole == "Admin" || currentUserRole == "Manager") || Model.SuperiorId == currentUserId))
    {
        <form asp-action="ApproveCancel" asp-route-id="@Model.RequestId" method="post" class="d-inline">
            <button type="submit" class="btn btn-success">Approve Cancel</button>
        </form>
    }

    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>